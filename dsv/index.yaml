---
- hosts: dsv
  remote_user: diana
  vars:
    dsv_repo: https://github.com/DigitalShooting/DSV.git
    dsv_version: v1.1

  tasks:
  - name: Installing git, npm and nodejs
    apt: name={{item}} state=latest
    with_items:
    - git
    - nodejs
    - npm
    sudo: yes

  - name: Adding user dsv
    user: name=dsv shell=/bin/bash
    sudo: yes

  - name: Pulling dsv repo
    git: repo={{dsv_repo}} dest=/home/dsv/dsv/ force=yes version={{dsv_version}}
    become: yes
    become_user: dsv
  - name: NPM Install in dsv
    npm: path=/home/dsv/dsv/
    become: yes
    become_user: dsv

  - name: Seting up dsv systemd service
    template: src=other/dsv.service dest=/etc/systemd/system/dsv.service owner=root group=root
    sudo: yes
  - name: Restarting dsv systemd service
    service: name=dsv state=restarted enabled=yes
    sudo: yes
